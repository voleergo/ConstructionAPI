<!DOCTYPE html>
<html>
<head>
    <title>CORS Test for Construction API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîó CORS Test for Construction API</h1>
    <p>This page tests Cross-Origin Resource Sharing (CORS) for your Construction API endpoints.</p>
    
    <div class="test-section">
        <h3>API Base URL Configuration</h3>
        <label for="apiUrl">API URL:</label>
        <input type="text" id="apiUrl" value="https://localhost:7040" style="width: 300px;">
        <p><small>Update this URL to match your API's running address.</small></p>
    </div>

    <div class="test-section">
        <h3>üß™ CORS Tests</h3>
        <button onclick="testCustomers()">Test GET /api/Customer</button>
        <button onclick="testProjects()">Test GET /api/Project</button>
        <button onclick="testUsers()">Test GET /api/User</button>
        <button onclick="testItems()">Test GET /api/Item</button>
        <button onclick="testLevels()">Test GET /api/Level</button>
        <button onclick="testSuppliers()">Test GET /api/Supplier</button>
        <button onclick="testUserRoles()">Test GET /api/UserRole</button>
        <button onclick="testProjectLevels()">Test GET /api/ProjectLevel</button>
        <button onclick="testProjectTrans()">Test GET /api/ProjectTrans</button>
        <br><br>
        <button onclick="testAllEndpoints()" style="background: #007bff; color: white;">üöÄ Test All Endpoints</button>
        <button onclick="clearResults()" style="background: #dc3545; color: white;">üóëÔ∏è Clear Results</button>
    </div>

    <div id="results"></div>

    <script>
        function getApiUrl() {
            return document.getElementById('apiUrl').value.replace(/\/$/, '');
        }

        function addResult(endpoint, success, message, response) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-section ${success ? 'success' : 'error'}`;
            div.innerHTML = `
                <h4>${success ? '‚úÖ' : '‚ùå'} ${endpoint}</h4>
                <p><strong>Status:</strong> ${message}</p>
                ${response ? `<pre>${JSON.stringify(response, null, 2)}</pre>` : ''}
            `;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        async function testEndpoint(endpoint) {
            const url = `${getApiUrl()}${endpoint}`;
            try {
                console.log(`Testing: ${url}`);
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors'
                });

                if (response.ok) {
                    const data = await response.json();
                    addResult(endpoint, true, `Success! Status: ${response.status}`, 
                             Array.isArray(data) ? `Array with ${data.length} items` : data);
                } else {
                    addResult(endpoint, false, `HTTP Error: ${response.status} ${response.statusText}`, null);
                }
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('CORS')) {
                    addResult(endpoint, false, `CORS Error: ${error.message}`, null);
                } else {
                    addResult(endpoint, false, `Network Error: ${error.message}`, null);
                }
            }
        }

        function testCustomers() { testEndpoint('/api/Customer'); }
        function testProjects() { testEndpoint('/api/Project'); }
        function testUsers() { testEndpoint('/api/User'); }
        function testItems() { testEndpoint('/api/Item'); }
        function testLevels() { testEndpoint('/api/Level'); }
        function testSuppliers() { testEndpoint('/api/Supplier'); }
        function testUserRoles() { testEndpoint('/api/UserRole'); }
        function testProjectLevels() { testEndpoint('/api/ProjectLevel'); }
        function testProjectTrans() { testEndpoint('/api/ProjectTrans'); }

        async function testAllEndpoints() {
            clearResults();
            const endpoints = [
                '/api/Customer',
                '/api/Project', 
                '/api/User',
                '/api/Item',
                '/api/Level',
                '/api/Supplier',
                '/api/UserRole',
                '/api/ProjectLevel',
                '/api/ProjectTrans'
            ];

            for (const endpoint of endpoints) {
                await testEndpoint(endpoint);
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between requests
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Auto-detect common development URLs
        window.onload = function() {
            const currentHost = window.location.hostname;
            if (currentHost === 'localhost' || currentHost === '127.0.0.1') {
                // Try to auto-detect API URL
                document.getElementById('apiUrl').value = 'https://localhost:7040';
            }
        };
    </script>
</body>
</html>
